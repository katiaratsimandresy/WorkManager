/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/thirdparty/URI','sap/ui/Device','sap/ui/test/_XHRCounter'],function(q,U,D,_){"use strict";var l="Opa5 - finding controls",$=q,f=null,F=null,o=null,a=null,b=null,r=false,u=false,x=null;function h(){f=F[0].contentWindow;c();d();}function c(){if(D.browser.internet_explorer&&D.browser.version===9){return;}var s=f.onerror;f.onerror=function(E,t,L){if(s){s.apply(this,arguments);}throw"OpaFrame error message: "+E+" url: "+t+" line: "+L;};}function d(){if(u){return true;}if(f&&f.sap&&f.sap.ui&&f.sap.ui.getCore){if(!r){f.sap.ui.getCore().attachInit(g);}r=true;}return u;}function e(s){f.sap.ui.require(["sap/ui/thirdparty/sinon"],function(t){if(!t){setTimeout(function(){e(s);},50);}else{s();}});}function g(){j();if(D.browser.firefox){e(k);}else{k();}}function i(){u=true;}function j(){b=f.jQuery;n("sap.ui.test");n("sap.ui.qunit");n("sap.ui.thirdparty");}function m(){f.jQuery.sap.require("sap.ui.thirdparty.hasher");f.jQuery.sap.require("sap.ui.core.routing.History");f.jQuery.sap.require("sap.ui.core.routing.HashChanger");var H=new f.sap.ui.core.routing.HashChanger(),s=new f.sap.ui.core.routing.History(H),t=f.hasher,O=t.setHash,v=t.getHash,C,K=false,w=f.history.go;t.replaceHash=function(A){K=true;var B=this.getHash();C=A;H.fireEvent("hashReplaced",{sHash:A});this.changed.dispatch(A,B);};t.setHash=function(A){K=true;var R=v.call(this);C=A;H.fireEvent("hashSet",{sHash:A});O.apply(this,arguments);if(R===this.getHash()){this.changed.dispatch(R,s.aHistory[s.iHistoryPosition]);}};t.getHash=function(){if(C===undefined){return v.apply(this,arguments);}return C;};t.changed.add(function(N){if(!K){H.fireEvent("hashSet",{sHash:N});C=N;}K=false;});H.init();function y(){K=true;var N=s.aHistory[s.iHistoryPosition],A=s.getPreviousHash();C=A;t.changed.dispatch(A,N);}function z(){K=true;var N=s.aHistory[s.iHistoryPosition+1],A=s.aHistory[s.iHistoryPosition];if(N===undefined){q.sap.log.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return;}C=N;t.changed.dispatch(N,A);}f.history.back=y;f.history.forward=z;f.history.go=function(S){if(S===-1){y();return;}else if(S===1){z();return;}q.sap.log.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return w.apply(f.history,arguments);};}function k(){f.sap.ui.require(["sap/ui/test/OpaPlugin","sap/ui/test/_XHRCounter","sap/ui/qunit/QUnitUtils","sap/ui/thirdparty/hasher","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger"],function(O,_,Q,s,H,t){o=new O(l);x=_;a=Q;m(s,H,t);i();});}function n(M){var O=q.sap.getModulePath(M);var A=new U(O).absoluteTo(document.baseURI).search("").toString();b.sap.registerModulePath(M,A);}function p(){f.onerror=$.noop;F.remove();b=null;o=null;a=null;f=null;u=false;r=false;x=null;}return{launch:function(s){if(f){$.sap.log.error("sap.ui.test.launchers.iFrameLauncher: Only one IFrame may be loaded at a time.");return;}F=$("#"+s.frameId);if(!F.length){if(!s.source){$.sap.log.error("No source was given to launch the IFrame",this);}F=$('<IFrame id="'+s.frameId+'" class="opaFrame" src="'+s.source+'"></IFrame>');$("body").append(F);}if(F[0].contentDocument&&F[0].contentDocument.readyState==="complete"){h();}else{F.on("load",h);}return d();},getHashChanger:function(){if(!f){return null;}f.jQuery.sap.require("sap.ui.core.routing.HashChanger");return f.sap.ui.core.routing.HashChanger.getInstance();},getPlugin:function(){return o;},getJQuery:function(){return b;},getUtils:function(){return a;},hasLaunched:function(){d();return u;},getWindow:function(){return f;},_getIXHRCounter:function(){return x||_;},teardown:function(){p();},_sLogPrefix:l};},true);
